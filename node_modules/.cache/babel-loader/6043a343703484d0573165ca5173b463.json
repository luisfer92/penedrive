{"ast":null,"code":"var _jsxFileName = \"/home/luisfer/Escritorio/rerovaji-control/src/contexts/LocalContext.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useEffect } from 'react';\nimport { database } from '../firebase';\nimport { useAuth } from './AuthContext';\nimport { CompisProvider } from './CompisContext';\nimport { ContratoProvider } from './ContratoContext';\nimport { MaquinariaProvider } from './MaquinariaContext';\nimport { MessageProvider } from './MessageContext';\nimport { TecnicosProvider } from './TenicosContext';\nimport { TrabajadorProvider } from './TrabajadorContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst LocalContext = /*#__PURE__*/React.createContext();\nexport function useLocal() {\n  _s();\n\n  return React.useContext(LocalContext);\n}\n\n_s(useLocal, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nexport function LocalProvider({\n  children\n}) {\n  _s2();\n\n  const {\n    userAPI\n  } = useAuth();\n  const [locales, setLocales] = React.useState();\n  const [local, setLocal] = React.useState(null);\n  const [categorias, setCategorias] = React.useState();\n  useEffect(() => {\n    let unsubscribre = null;\n\n    if (local) {\n      unsubscribre = database.collection('locales').doc(local.id).onSnapshot(snap => {\n        const newLocal = {\n          id: snap.id,\n          ...snap.data()\n        };\n        setLocal(newLocal);\n        window.localStorage.setItem('rerovaji_local', JSON.stringify(newLocal));\n      });\n    } else {\n      const newLocal = window.localStorage.getItem('rerovaji_local');\n      console.log(\"local guardado en localstorage\");\n      newLocal && setLocal(JSON.parse(newLocal));\n    }\n\n    return unsubscribre ? () => unsubscribre() : null;\n  }, [setLocal]);\n  useEffect(() => {\n    if (userAPI) {\n      const load = [];\n      database.collection(\"locales\").where('allowed_users', 'array-contains', userAPI.correo).get().then(query => {\n        query.forEach(doc => {\n          load.push({\n            id: doc.id,\n            ...doc.data()\n          });\n        });\n        const size = load.length;\n        console.log(size);\n        setLocales(load);\n        size == 1 && setLocal(load[0]);\n      });\n    }\n  }, [userAPI]);\n\n  const addCompi = correo => {\n    if (local) {\n      var {\n        allowed_users\n      } = local;\n      allowed_users.push(correo);\n      database.collection(\"locales\").doc(local.id).set(Object.assign({}, local, allowed_users));\n    }\n  };\n\n  const value = {\n    local,\n    locales,\n    abandonarLocal: () => {\n      setLocal(null);\n    },\n    setLocal,\n    setLocales,\n    addCompi\n  };\n  return /*#__PURE__*/_jsxDEV(LocalContext.Provider, {\n    value: value,\n    children: /*#__PURE__*/_jsxDEV(TecnicosProvider, {\n      children: /*#__PURE__*/_jsxDEV(MaquinariaProvider, {\n        children: /*#__PURE__*/_jsxDEV(CompisProvider, {\n          children: /*#__PURE__*/_jsxDEV(ContratoProvider, {\n            children: /*#__PURE__*/_jsxDEV(TrabajadorProvider, {\n              children: /*#__PURE__*/_jsxDEV(MessageProvider, {\n                children: children\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 101,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 99,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 92,\n    columnNumber: 9\n  }, this);\n}\n\n_s2(LocalProvider, \"3wHKnstYCY6UYXbIIJkhRz0BVMg=\", false, function () {\n  return [useAuth];\n});\n\n_c = LocalProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"LocalProvider\");","map":{"version":3,"sources":["/home/luisfer/Escritorio/rerovaji-control/src/contexts/LocalContext.js"],"names":["React","useEffect","database","useAuth","CompisProvider","ContratoProvider","MaquinariaProvider","MessageProvider","TecnicosProvider","TrabajadorProvider","LocalContext","createContext","useLocal","useContext","LocalProvider","children","userAPI","locales","setLocales","useState","local","setLocal","categorias","setCategorias","unsubscribre","collection","doc","id","onSnapshot","snap","newLocal","data","window","localStorage","setItem","JSON","stringify","getItem","console","log","parse","load","where","correo","get","then","query","forEach","push","size","length","addCompi","allowed_users","set","Object","assign","value","abandonarLocal"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react'\nimport { database } from '../firebase'\nimport { useAuth } from './AuthContext';\nimport { CompisProvider } from './CompisContext';\nimport { ContratoProvider } from './ContratoContext';\nimport { MaquinariaProvider } from './MaquinariaContext';\nimport { MessageProvider } from './MessageContext'\nimport { TecnicosProvider } from './TenicosContext';\nimport { TrabajadorProvider } from './TrabajadorContext';\n\nconst LocalContext = React.createContext();\n\n\n\nexport function useLocal() {\n    return React.useContext(LocalContext)\n}\n\n\nexport function LocalProvider({ children }) {\n\n    const { userAPI } = useAuth()\n    const [locales, setLocales] = React.useState()\n    const [local, setLocal] = React.useState(null);\n    const [categorias, setCategorias] = React.useState();\n\n   \n\n    useEffect(() => {\n        let unsubscribre = null\n        if (local) {\n            unsubscribre = database.\n                collection('locales').\n                doc(local.id).\n                onSnapshot(\n                    snap => {\n                        const newLocal = { id: snap.id, ...snap.data() }\n                        setLocal(newLocal)\n                        window.localStorage.setItem('rerovaji_local', JSON.stringify(newLocal))\n                    }\n                )\n        } else {\n            const newLocal = window.localStorage.getItem('rerovaji_local')\n            console.log(\"local guardado en localstorage\")\n            newLocal && setLocal(JSON.parse(newLocal))\n        }\n        return unsubscribre ? () => unsubscribre() : null\n    }, [setLocal])\n\n\n    useEffect(() => {\n        if (userAPI) {\n\n            const load = []\n            database.collection(\"locales\").\n                where('allowed_users', 'array-contains', userAPI.correo).\n                get().then((query) => {\n                    query.forEach(doc => {\n                        load.push({ id: doc.id, ...doc.data() })\n\n                    })\n                    const size = load.length\n                    console.log(size)\n                    setLocales(load)\n                    size == 1 && setLocal(load[0])\n                })\n\n        }\n    }, [userAPI])\n\n\n    const addCompi = (correo) => {\n        if (local) {\n            var { allowed_users } = local\n            allowed_users.push(correo)\n            database.collection(\"locales\").doc(local.id).set(Object.assign({},local,allowed_users))\n        }\n\n    }\n\n\n    const value = {\n        local,\n        locales,\n        abandonarLocal: () => { setLocal(null) },\n        setLocal,\n        setLocales,\n        addCompi\n    }\n\n    return (\n        <LocalContext.Provider value={value}>\n            <TecnicosProvider>\n\n                <MaquinariaProvider>\n\n                    <CompisProvider>\n                        <ContratoProvider>\n                            <TrabajadorProvider>\n\n                                <MessageProvider>\n                                    {children}\n                                </MessageProvider>\n\n                            </TrabajadorProvider>\n                        </ContratoProvider>\n                    </CompisProvider>\n\n                </MaquinariaProvider>\n\n            </TecnicosProvider>\n\n\n\n\n        </LocalContext.Provider>\n    )\n}"]},"metadata":{},"sourceType":"module"}