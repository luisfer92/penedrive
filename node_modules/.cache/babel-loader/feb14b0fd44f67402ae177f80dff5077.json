{"ast":null,"code":"import _objectSpread from\"/home/luisfer/Escritorio/rerovaji-control/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/luisfer/Escritorio/rerovaji-control/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from'react';import MainHolder from'../common/MainHolder';import{Link,useParams}from\"react-router-dom\";import{useProducto}from'../../contexts/ProductoContext';import{Col,Form,Row,InputGroup,Spinner}from'react-bootstrap';import{FaAdjust,FaEuroSign,FaBox,FaFingerprint,FaLock,FaShareAlt,FaThumbsUp,FaAngleRight,FaAngleLeft}from'react-icons/fa';import Producto from'./ProductoClasificable';import SecondaryHolder from'../common/SecondaryHolder';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var FormItem=function FormItem(props){var nombre=props.nombre,value=props.value,holder=props.holder,_props$lock=props.lock,lock=_props$lock===void 0?false:_props$lock,cambios=props.cambios,handleChange=props.handleChange,saved=props.saved;var _useState=useState(value),_useState2=_slicedToArray(_useState,2),initial=_useState2[0],setInitial=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),autosave=_useState4[0],setAutosave=_useState4[1];var saving=cambios&&Object.keys(cambios).includes(nombre.toLowerCase())&&autosave;var setValue=function setValue(event){var val=event.target.value.trim().toLowerCase();var newCambio={};if(initial!==val){newCambio[nombre.toLowerCase()]=val;var newChanges=Object.assign({},cambios,newCambio);setInitial(val);handleChange(newChanges);}else{}};var handleItemChange=function handleItemChange(event){console.log(initial);var val=event.target.value;if(val!==\"\"&&initial!==val){if(autosave){console.log(\"sigues escribiendo\");clearTimeout(autosave);setAutosave(setTimeout(function(){setValue(event);},2000));}else{console.log(\"has empezado a escribir\");setAutosave(setTimeout(function(){setValue(event);},2000));}}else{console.log(\"los valores de inicio y actual coinciden\");clearTimeout(autosave);setAutosave(false);}};return/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-2\",as:Col,xs:12,children:[/*#__PURE__*/_jsx(Form.Label,{children:nombre}),/*#__PURE__*/_jsxs(InputGroup,{className:\"mb-2\",children:[/*#__PURE__*/_jsx(Form.Control,{placeholder:value?value:holder,readOnly:lock,onChange:handleItemChange}),lock&&/*#__PURE__*/_jsx(InputGroup.Text,{className:\"text-warning fs-1 bg-transparent\",children:/*#__PURE__*/_jsx(FaLock,{})}),saving&&!saved&&/*#__PURE__*/_jsx(InputGroup.Text,{className:\"text-warning fs-1 bg-transparent\",children:/*#__PURE__*/_jsx(Spinner,{animation:\"grow\"})})]})]});};var CategoriaEdicion=function CategoriaEdicion(props){var children=props.children,nombre=props.nombre,icono=props.icono;var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),active=_useState6[0],setActive=_useState6[1];return/*#__PURE__*/_jsxs(Col,{sm:12,lg:12,xl:6,className:\"\".concat(active?\"border\":\"border-top\",\" border-white border-3 rounded rounded-2 px-2 mb-sm-2 h-auto my-2\"),children:[/*#__PURE__*/_jsxs(Col,{xs:12,className:\"\".concat(!active?\"border border-3\":\"border-bottom\",\" border-white fs-3 d-flex py-auto justify-content-center  text-white\"),onClick:function onClick(){return setActive(!active);},children:[/*#__PURE__*/_jsx(\"span\",{className:\"me-2 text-capitalize\",children:nombre}),/*#__PURE__*/_jsx(\"span\",{children:icono})]}),/*#__PURE__*/_jsx(Col,{xs:12,className:\"px-2\",children:active&&children})]});};var Categoria=function Categoria(props){var nombre=props.nombre,id=props.id;return/*#__PURE__*/_jsx(\"option\",{value:id,children:nombre});};var Editor=function Editor(props){var _useParams=useParams(),id=_useParams.id;var _useProducto=useProducto(),productos=_useProducto.productos,categorias=_useProducto.categorias,upgradeProducto=_useProducto.upgradeProducto;var _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),current=_useState8[0],setCurrent=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),cambios=_useState10[0],setCambios=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),autosave=_useState12[0],setAutosave=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),saved=_useState14[0],setSaved=_useState14[1];useEffect(function(){productos&&setCurrent(productos.find(function(p){return p.id==id;}));},[productos]);useEffect(function(){cambios&&upgradeProducto(id,cambios);},[cambios]);var getCategoria=function getCategoria(catId){var categoria=categorias.find(function(c){return c.id===catId;});return categoria;};var save=function save(cambios){console.log(\"Guardando los cambios en firebase\");setCambios(cambios);setSaved(true);};var handleSave=function handleSave(cambios){console.log(\"cambio requrido\");console.log(cambios);setSaved(false);if(autosave){console.log(\"sigues modificando el formulario\");window.clearTimeout(autosave);setAutosave(window.setTimeout(function(){save(cambios);},5000));}else{console.log(\"has modificado el formulario\");setAutosave(window.setTimeout(function(){save(cambios);},5000));}};var handleDropdowns=function handleDropdowns(event){var _event$target=event.target,value=_event$target.value,id=_event$target.id;console.log(id);if(id===\"categorias\"){handleSave(Object.assign({},cambios,{categoria_id:value}));}if(id===\"iva\"){handleSave(Object.assign({},cambios,{iva:value}));}};var nombre=current.nombre,precio=current.precio,unidades=current.unidades,paquetes=current.paquetes,peso=current.peso,iva=current.iva,categoria_id=current.categoria_id;var codigo_barras=current.codigo_barras,codisis_id=current.codisis_id;var categoria=categoria_id&&getCategoria(categoria_id);return/*#__PURE__*/_jsx(SecondaryHolder,{title:\"Editar - \"+nombre,back:\"/productos\",children:/*#__PURE__*/_jsxs(Row,{className:\"justify-content-center justify-content-lg-around mx-auto w-100 align-items-center pt-2\",children:[/*#__PURE__*/_jsx(Col,{xs:12,md:8,lg:4,xl:3,className:\"d-flex  justify-content-center align-items-center \",children:productos&&/*#__PURE__*/_jsx(Producto,_objectSpread(_objectSpread({},current),{},{editable:true,expand:true}))}),/*#__PURE__*/_jsx(Col,{md:12,lg:7,xl:8,className:\" text-white py-2 px-0\",children:/*#__PURE__*/_jsxs(Form,{as:Row,className:\"bg-oscuro justify-content-around\",children:[/*#__PURE__*/_jsx(FormItem,{nombre:\"Nombre\",value:nombre,holder:\"Nombre del producto\",handleChange:handleSave,cambios:cambios,saved:saved}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-2\",as:Col,xs:12,children:[/*#__PURE__*/_jsx(Form.Label,{children:\"Categoria\"}),/*#__PURE__*/_jsxs(Form.Select,{id:\"categorias\",onChange:handleDropdowns,children:[categoria?/*#__PURE__*/_jsx(Categoria,_objectSpread({},categoria)):/*#__PURE__*/_jsx(\"option\",{children:\" Categoria del producto \"}),categorias&&categorias.map(function(c){return c.id!==categoria_id?/*#__PURE__*/_jsx(Categoria,_objectSpread({},c)):null;})]})]}),/*#__PURE__*/_jsx(CategoriaEdicion,{nombre:\"exclusivo\",children:/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-2 ps-3 ps-md-0 d-sm-flex d-lg-block justify-content-center pt-2 bg-info\",as:Col,xs:12,children:[/*#__PURE__*/_jsx(Form.Check,{inline:true,label:\"No\",name:\"no_exclusivo\",type:\"checkbox\",id:\"no\",className:\"w-100 w-md-auto  my-2 my-md-auto  w-lg-100 \"}),/*#__PURE__*/_jsx(Form.Check,{inline:true,label:\"Andalucia\",name:\"andalucia\",type:\"checkbox\",id:\"andalucia\",className:\"w-100 w-md-auto  my-2 my-md-auto  w-lg-100 \"}),/*#__PURE__*/_jsx(Form.Check,{inline:true,label:\"Levante\",name:\"levante\",type:\"checkbox\",id:\"levante\",className:\"w-100 w-md-auto  my-2 my-md-auto w-lg-100 \"}),/*#__PURE__*/_jsx(Form.Check,{inline:true,label:\"Canarias\",name:\"canarias\",type:\"checkbox\",id:\"canarias\",className:\"w-100 w-md-auto my-2 my-md-auto  w-lg-100 \"}),/*#__PURE__*/_jsx(Form.Check,{inline:true,label:\"Baleares\",name:\"baleares\",type:\"checkbox\",id:\"baleares\",className:\"w-100 w-md-auto  my-2 my-md-auto  w-lg-100 \"}),/*#__PURE__*/_jsx(Form.Check,{inline:true,label:\"Santa justa\",name:\"santa_justa\",type:\"checkbox\",id:\"santa_justa\",className:\"w-100 w-md-auto  my-2 my-md-auto  w-lg-100 \"})]})}),/*#__PURE__*/_jsxs(CategoriaEdicion,{nombre:\"identificacion\",icono:/*#__PURE__*/_jsx(FaFingerprint,{}),children:[/*#__PURE__*/_jsx(FormItem,{nombre:\"ID\",value:id,hoder:\"Id del producto\",lock:true,handleChange:handleSave,saved:saved}),/*#__PURE__*/_jsx(FormItem,{nombre:\"codigo_barras\",value:codigo_barras,hoder:\"Codigo de barras del producto\",handleChange:handleSave,saved:saved}),/*#__PURE__*/_jsx(FormItem,{nombre:\"codisis_id\",value:codisis_id,hoder:\"Codigo de barras del producto\",handleChange:handleSave,saved:saved})]}),/*#__PURE__*/_jsxs(CategoriaEdicion,{nombre:\"valor\",icono:/*#__PURE__*/_jsx(FaEuroSign,{}),children:[/*#__PURE__*/_jsx(FormItem,{nombre:\"Precio\",value:precio,hoder:\"Precio del producto\",handleChange:handleSave,saved:saved}),/*#__PURE__*/_jsxs(Form.Group,{className:\"mb-2\",as:Col,xs:12,children:[/*#__PURE__*/_jsx(Form.Label,{children:\"IVA\"}),/*#__PURE__*/_jsxs(Form.Select,{id:\"iva\",onChange:handleDropdowns,children:[/*#__PURE__*/_jsx(\"option\",{children:iva?iva:\"IVA del producto\"}),/*#__PURE__*/_jsx(\"option\",{value:\"10\",children:\"10%\"}),/*#__PURE__*/_jsx(\"option\",{value:\"4\",children:\"4%\"}),/*#__PURE__*/_jsx(\"option\",{value:\"21\",children:\"21%\"})]})]})]}),/*#__PURE__*/_jsxs(CategoriaEdicion,{nombre:\"empaquetado\",icono:/*#__PURE__*/_jsx(FaBox,{}),children:[/*#__PURE__*/_jsx(FormItem,{nombre:\"Unidades\",value:unidades,holder:\"unidades por caja\",handleChange:handleSave,saved:saved}),/*#__PURE__*/_jsx(FormItem,{nombre:\"Paquetes\",value:paquetes,holder:\"paquetes por caja\",handleChange:handleSave,saved:saved}),/*#__PURE__*/_jsx(FormItem,{nombre:\"Peso\",value:peso,holder:\"peso del paquete\",handleChange:handleSave,saved:saved})]})]})})]})});};export default Editor;","map":{"version":3,"sources":["/home/luisfer/Escritorio/rerovaji-control/src/components/superAdmin/ProductoEditor.js"],"names":["React","useEffect","useRef","useState","MainHolder","Link","useParams","useProducto","Col","Form","Row","InputGroup","Spinner","FaAdjust","FaEuroSign","FaBox","FaFingerprint","FaLock","FaShareAlt","FaThumbsUp","FaAngleRight","FaAngleLeft","Producto","SecondaryHolder","FormItem","props","nombre","value","holder","lock","cambios","handleChange","saved","initial","setInitial","autosave","setAutosave","saving","Object","keys","includes","toLowerCase","setValue","event","val","target","trim","newCambio","newChanges","assign","handleItemChange","console","log","clearTimeout","setTimeout","CategoriaEdicion","children","icono","active","setActive","Categoria","id","Editor","productos","categorias","upgradeProducto","current","setCurrent","setCambios","setSaved","find","p","getCategoria","catId","categoria","c","save","handleSave","window","handleDropdowns","categoria_id","iva","precio","unidades","paquetes","peso","codigo_barras","codisis_id","map"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\nimport MainHolder from '../common/MainHolder'\nimport { Link, useParams } from \"react-router-dom\";\nimport { useProducto } from '../../contexts/ProductoContext';\nimport { Col, Form, Row, InputGroup, Spinner } from 'react-bootstrap';\nimport { FaAdjust, FaEuroSign, FaBox, FaFingerprint, FaLock, FaShareAlt, FaThumbsUp, FaAngleRight, FaAngleLeft } from 'react-icons/fa';\nimport Producto from './ProductoClasificable'\nimport SecondaryHolder from '../common/SecondaryHolder';\n\n\n\nconst FormItem = (props) => {\n    const { nombre, value, holder, lock = false, cambios, handleChange, saved } = props\n    const [initial, setInitial] = useState(value)\n    const [autosave, setAutosave] = useState(null)\n    const saving = (cambios && Object.keys(cambios).includes(nombre.toLowerCase()) && autosave)\n\n\n    const setValue = (event) => {\n        const val = event.target.value.trim().toLowerCase()\n        var newCambio = {}\n        if (initial !== val) {\n            newCambio[nombre.toLowerCase()] = val\n            const newChanges = Object.assign({}, cambios, newCambio)\n\n            setInitial(val)\n            handleChange(newChanges)\n        } else {\n\n        }\n    }\n\n\n    const handleItemChange = (event) => {\n        console.log(initial)\n        const val = event.target.value\n        if ((val !== \"\") && (initial !== val)) {\n            if (autosave) {\n                console.log(\"sigues escribiendo\")\n                clearTimeout(autosave)\n                setAutosave(setTimeout(() => { setValue(event) }, 2000))\n            } else {\n                console.log(\"has empezado a escribir\")\n                setAutosave(setTimeout(() => { setValue(event) }, 2000))\n            }\n        } else {\n            console.log(\"los valores de inicio y actual coinciden\")\n            clearTimeout(autosave)\n            setAutosave(false)\n        }\n\n    }\n\n\n    return (\n        <Form.Group className=\"mb-2\" as={Col} xs={12}>\n            <Form.Label>\n                {nombre}\n            </Form.Label>\n            <InputGroup className=\"mb-2\">\n\n                <Form.Control placeholder={value ? value : holder} readOnly={lock} onChange={handleItemChange} />\n\n\n                {lock && <InputGroup.Text className=\"text-warning fs-1 bg-transparent\"><FaLock /></InputGroup.Text>}\n                {(saving && !saved) && <InputGroup.Text className=\"text-warning fs-1 bg-transparent\"><Spinner animation=\"grow\" /></InputGroup.Text>}\n\n            </InputGroup>\n\n        </Form.Group>\n\n    )\n}\n\n\n\nconst CategoriaEdicion = (props) => {\n    const { children, nombre, icono } = props\n\n    const [active, setActive] = useState(false)\n\n    return (\n\n        <Col sm={12} lg={12} xl={6} className={`${active ? \"border\" : \"border-top\"} border-white border-3 rounded rounded-2 px-2 mb-sm-2 h-auto my-2`}>\n\n            <Col xs={12} className={`${!active ? \"border border-3\" : \"border-bottom\"} border-white fs-3 d-flex py-auto justify-content-center  text-white`} onClick={() => setActive(!active)}>\n                <span className=\"me-2 text-capitalize\">{nombre}</span>\n                <span>{icono}</span>\n            </Col>\n\n            <Col xs={12} className=\"px-2\">\n                {active && children}\n\n            </Col>\n\n\n\n        </Col>\n    )\n}\n\n\nconst Categoria = (props) => {\n    const { nombre, id } = props\n\n    return <option value={id}>{nombre}</option>\n}\n\n\nconst Editor = (props) => {\n    const { id } = useParams();\n    const { productos, categorias, upgradeProducto } = useProducto()\n    const [current, setCurrent] = useState({})\n    const [cambios, setCambios] = useState(null)\n    const [autosave, setAutosave] = useState(null)\n    const [saved, setSaved] = useState(false)\n\n    useEffect(() => {\n        productos && setCurrent(productos.find(p => p.id == id))\n    }, [productos])\n\n    useEffect(() => {\n        cambios && upgradeProducto(id, cambios)\n    }, [cambios])\n\n    const getCategoria = (catId) => {\n        const categoria = categorias.find(c => c.id === catId)\n        return categoria\n    }\n\n    const save = (cambios) => {\n        console.log(\"Guardando los cambios en firebase\")\n        setCambios(cambios)\n        setSaved(true)\n    }\n\n    const handleSave = (cambios) => {\n        console.log(\"cambio requrido\")\n        console.log(cambios)\n        setSaved(false)\n        if (autosave) {\n            console.log(\"sigues modificando el formulario\")\n            window.clearTimeout(autosave)\n            setAutosave(window.setTimeout(() => { save(cambios) }, 5000))\n        } else {\n            console.log(\"has modificado el formulario\")\n            setAutosave(window.setTimeout(() => { save(cambios) }, 5000))\n        }\n    }\n\n    const handleDropdowns = (event) => {\n        const { value, id } = event.target\n\n        console.log(id)\n        if (id === \"categorias\") {\n            handleSave(Object.assign({}, cambios, { categoria_id: value }))\n        }\n        if (id === \"iva\") {\n            handleSave(Object.assign({}, cambios, { iva: value }))\n        }\n    }\n\n\n\n\n    const { nombre, precio, unidades, paquetes, peso, iva, categoria_id } = current\n    const { codigo_barras, codisis_id } = current\n    const categoria = categoria_id && getCategoria(categoria_id)\n\n    return (\n        <SecondaryHolder title={\"Editar - \"+nombre} back=\"/productos\">\n            <Row className=\"justify-content-center justify-content-lg-around mx-auto w-100 align-items-center pt-2\" >\n\n                \n                <Col xs={12} md={8} lg={4} xl={3} className=\"d-flex  justify-content-center align-items-center \">\n                    {productos && <Producto {...current} editable={true} expand={true} />}\n                </Col>\n\n                <Col md={12} lg={7} xl={8} className=\" text-white py-2 px-0\" >\n                    <Form as={Row} className=\"bg-oscuro justify-content-around\">\n\n\n\n                        <FormItem nombre=\"Nombre\" value={nombre} holder=\"Nombre del producto\" handleChange={handleSave} cambios={cambios} saved={saved} />\n                        <Form.Group className=\"mb-2\" as={Col} xs={12} >\n                            <Form.Label>Categoria</Form.Label>\n                            <Form.Select id=\"categorias\" onChange={handleDropdowns}>\n                                {categoria ? <Categoria {...categoria} /> : <option> Categoria del producto </option>}\n                                {categorias && categorias.map(c => c.id !== categoria_id ? <Categoria {...c} /> : null)}\n                            </Form.Select>\n                        </Form.Group>\n\n                        <CategoriaEdicion nombre=\"exclusivo\">\n\n                            <Form.Group className=\"mb-2 ps-3 ps-md-0 d-sm-flex d-lg-block justify-content-center pt-2 bg-info\" as={Col} xs={12} >\n                                <Form.Check\n                                    inline\n                                    label=\"No\"\n                                    name=\"no_exclusivo\"\n                                    type='checkbox'\n                                    id='no'\n                                    className=\"w-100 w-md-auto  my-2 my-md-auto  w-lg-100 \"\n\n\n                                />\n                                <Form.Check\n                                    inline\n                                    label=\"Andalucia\"\n                                    name=\"andalucia\"\n                                    type='checkbox'\n                                    id='andalucia'\n                                    className=\"w-100 w-md-auto  my-2 my-md-auto  w-lg-100 \"\n\n\n                                />\n                                <Form.Check\n                                    inline\n                                    label=\"Levante\"\n                                    name=\"levante\"\n                                    type='checkbox'\n                                    id='levante'\n                                    className=\"w-100 w-md-auto  my-2 my-md-auto w-lg-100 \"\n                                />\n\n                                <Form.Check\n                                    inline\n                                    label=\"Canarias\"\n                                    name=\"canarias\"\n                                    type='checkbox'\n                                    id='canarias'\n                                    className=\"w-100 w-md-auto my-2 my-md-auto  w-lg-100 \"\n\n                                />\n\n                                <Form.Check\n                                    inline\n                                    label=\"Baleares\"\n                                    name=\"baleares\"\n                                    type='checkbox'\n                                    id='baleares'\n                                    className=\"w-100 w-md-auto  my-2 my-md-auto  w-lg-100 \"\n\n                                />\n\n                                <Form.Check\n                                    inline\n                                    label=\"Santa justa\"\n                                    name=\"santa_justa\"\n                                    type='checkbox'\n                                    id='santa_justa'\n                                    className=\"w-100 w-md-auto  my-2 my-md-auto  w-lg-100 \"\n\n                                />\n\n\n\n                            </Form.Group>\n\n\n\n                        </CategoriaEdicion>\n\n                        <CategoriaEdicion nombre=\"identificacion\" icono={<FaFingerprint />}>\n\n                            <FormItem nombre=\"ID\" value={id} hoder=\"Id del producto\" lock handleChange={handleSave} saved={saved} />\n                            <FormItem nombre=\"codigo_barras\" value={codigo_barras} hoder=\"Codigo de barras del producto\" handleChange={handleSave} saved={saved} />\n                            <FormItem nombre=\"codisis_id\" value={codisis_id} hoder=\"Codigo de barras del producto\" handleChange={handleSave} saved={saved} />\n\n\n                        </CategoriaEdicion>\n\n                        <CategoriaEdicion nombre=\"valor\" icono={<FaEuroSign />}>\n\n                            <FormItem nombre=\"Precio\" value={precio} hoder=\"Precio del producto\" handleChange={handleSave} saved={saved} />\n\n                            <Form.Group className=\"mb-2\" as={Col} xs={12}>\n                                <Form.Label>IVA</Form.Label>\n                                <Form.Select id=\"iva\" onChange={handleDropdowns}>\n                                    <option>{iva ? iva : \"IVA del producto\"}</option>\n                                    <option value=\"10\">10%</option>\n                                    <option value=\"4\">4%</option>\n                                    <option value=\"21\">21%</option>\n                                </Form.Select>\n                            </Form.Group>\n                        </CategoriaEdicion>\n\n\n\n                        <CategoriaEdicion nombre=\"empaquetado\" icono={<FaBox />}>\n\n                            <FormItem nombre=\"Unidades\" value={unidades} holder=\"unidades por caja\" handleChange={handleSave} saved={saved} />\n\n                            <FormItem nombre=\"Paquetes\" value={paquetes} holder=\"paquetes por caja\" handleChange={handleSave} saved={saved} />\n\n                            <FormItem nombre=\"Peso\" value={peso} holder=\"peso del paquete\" handleChange={handleSave} saved={saved} />\n\n                        </CategoriaEdicion>\n\n\n\n                    </Form>\n                </Col>\n\n            </Row>\n\n        </SecondaryHolder>\n    )\n}\n\n\nexport default Editor"]},"metadata":{},"sourceType":"module"}