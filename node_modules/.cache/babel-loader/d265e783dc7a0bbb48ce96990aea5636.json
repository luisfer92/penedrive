{"ast":null,"code":"import _objectSpread from\"/home/luisfer/Escritorio/rerovaji-control/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/luisfer/Escritorio/rerovaji-control/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{database,storage}from'../firebase';import{useAuth}from'./AuthContext';import{useCompis}from'./CompisContext';import{useLocal}from'./LocalContext';import firebase from\"firebase/app\";import moment from'moment';import'moment/locale/es';import{jsx as _jsx}from\"react/jsx-runtime\";moment.locale(\"es\");export var MesageContext=/*#__PURE__*/React.createContext();export function useMesage(){return React.useContext(MesageContext);}export function MessageProvider(_ref){var children=_ref.children;var _useLocal=useLocal(),local=_useLocal.local;var _useAuth=useAuth(),userAPI=_useAuth.userAPI;var _useState=useState(),_useState2=_slicedToArray(_useState,2),localRef=_useState2[0],setLocalRef=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),mensajes=_useState4[0],setMensajes=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),misMensajes=_useState6[0],setMisMensajes=_useState6[1];useEffect(function(){var msgs=null;if(local){msgs=database.collection(\"locales\").doc(local.id).collection(\"mensajes\").orderBy('date').onSnapshot(function(query){var newMsg=[];var myMsg=[];query.forEach(function(m){var id=m.id;var _data=m.data();var date=moment.utc(_data.date.seconds*1000);var data=Object.assign({},_data,{date:date});var from=data.from;if(from===userAPI){myMsg.push(_objectSpread({id:id},data));}newMsg.push(_objectSpread({id:id},data));});setMensajes(newMsg);setMisMensajes(myMsg);});}return msgs?function(){return msgs();}:null;},[setMensajes,local,userAPI]);var sendMensaje=function sendMensaje(data){var author=userAPI.correo;var date=firebase.firestore.Timestamp.fromDate(new Date());database.collection(\"locales\").doc(local.id).collection(\"mensajes\").add(_objectSpread({author:author,date:date},data));};var value={mensajes:mensajes,sendMensaje:sendMensaje};return/*#__PURE__*/_jsx(MesageContext.Provider,{value:value,children:children});}","map":{"version":3,"sources":["/home/luisfer/Escritorio/rerovaji-control/src/contexts/MessageContext.js"],"names":["React","useEffect","useState","database","storage","useAuth","useCompis","useLocal","firebase","moment","locale","MesageContext","createContext","useMesage","useContext","MessageProvider","children","local","userAPI","localRef","setLocalRef","mensajes","setMensajes","misMensajes","setMisMensajes","msgs","collection","doc","id","orderBy","onSnapshot","query","newMsg","myMsg","forEach","m","_data","data","date","utc","seconds","Object","assign","from","push","sendMensaje","author","correo","firestore","Timestamp","fromDate","Date","add","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react'\nimport { database, storage } from '../firebase'\nimport { useAuth } from './AuthContext';\nimport { useCompis } from './CompisContext';\nimport { useLocal } from './LocalContext'\nimport firebase from \"firebase/app\";\n\nimport moment from 'moment'\nimport 'moment/locale/es';\n\nmoment.locale(\"es\")\n\n\nexport const MesageContext = React.createContext();\n\n\n\n\nexport function useMesage() {\n    return React.useContext(MesageContext)\n}\nexport function MessageProvider({ children }) {\n    const { local } = useLocal()\n    const { userAPI } = useAuth()\n    const [localRef, setLocalRef] = useState()\n\n    const [mensajes, setMensajes] = useState()\n    const [misMensajes, setMisMensajes] = useState()\n\n\n\n    useEffect(() => {\n        let msgs = null\n        if (local) {\n            msgs = database.collection(\"locales\").doc(local.id).collection(\"mensajes\").orderBy('date').onSnapshot((query) => {\n                const newMsg = []\n                const myMsg = []\n                query.forEach(m => {\n                    const id = m.id\n                    const _data = m.data()\n                    const date=moment.utc(_data.date.seconds*1000)\n                    \n                    const data=Object.assign({},_data,{date})\n                    const { from } = data\n                    if ((from === userAPI)) {\n                        myMsg.push({ id, ...data })\n                    }\n                    newMsg.push({ id, ...data })\n\n\n                })\n                setMensajes(newMsg)\n                setMisMensajes(myMsg)\n            })\n        }\n        return msgs ? () => msgs() : null\n    }, [setMensajes, local, userAPI])\n\n    const sendMensaje = (data) => {\n        const author = userAPI.correo\n\n        const date = firebase.firestore.Timestamp.fromDate(new Date())\n        database.collection(\"locales\").doc(local.id).collection(\"mensajes\").add({ author, date, ...data })\n    }\n\n    const value = {\n        mensajes,\n        sendMensaje,\n    }\n\n\n    return (\n        <MesageContext.Provider value={value}>\n            {children}\n        </MesageContext.Provider>\n    )\n}"]},"metadata":{},"sourceType":"module"}